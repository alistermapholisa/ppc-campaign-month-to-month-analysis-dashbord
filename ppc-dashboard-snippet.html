<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PPC Campaign Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        /* Scoped styles to prevent conflicts with Elementor */
        .ppc-dashboard-container {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            padding: 24px;
            border-radius: 12px;
            max-width: 1400px;
            margin: 0 auto;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .ppc-dashboard-container * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        .ppc-header {
            text-align: center;
            margin-bottom: 32px;
            border-bottom: 3px solid #2563eb;
            padding-bottom: 20px;
        }

        .ppc-header h1 {
            font-size: 28px;
            font-weight: 700;
            color: #1e40af;
            margin-bottom: 8px;
        }

        .ppc-header p {
            font-size: 14px;
            color: #64748b;
        }

        .ppc-metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 32px;
        }

        .ppc-metric-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            border-left: 4px solid #2563eb;
        }

        .ppc-metric-card.accent-green {
            border-left-color: #10b981;
        }

        .ppc-metric-card.accent-orange {
            border-left-color: #f59e0b;
        }

        .ppc-metric-card.accent-red {
            border-left-color: #ef4444;
        }

        .ppc-metric-label {
            font-size: 12px;
            font-weight: 600;
            color: #64748b;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
        }

        .ppc-metric-value {
            font-size: 24px;
            font-weight: 700;
            color: #1e293b;
            margin-bottom: 4px;
        }

        .ppc-metric-change {
            font-size: 12px;
            color: #64748b;
        }

        .ppc-metric-change.positive {
            color: #10b981;
        }

        .ppc-metric-change.negative {
            color: #ef4444;
        }

        .ppc-charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 24px;
            margin-bottom: 32px;
        }

        .ppc-chart-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }

        .ppc-chart-title {
            font-size: 16px;
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 16px;
        }

        .ppc-chart-wrapper {
            position: relative;
            height: 300px;
        }

        .ppc-platforms-table {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            overflow: hidden;
            margin-bottom: 32px;
        }

        .ppc-table-header {
            background: linear-gradient(135deg, #2563eb 0%, #1e40af 100%);
            color: white;
            padding: 16px;
        }

        .ppc-table-header h3 {
            font-size: 16px;
            font-weight: 600;
        }

        .ppc-table {
            width: 100%;
            border-collapse: collapse;
        }

        .ppc-table thead tr {
            background: #f8fafc;
            border-bottom: 2px solid #e2e8f0;
        }

        .ppc-table th {
            padding: 12px 16px;
            text-align: left;
            font-size: 12px;
            font-weight: 600;
            color: #475569;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .ppc-table td {
            padding: 12px 16px;
            border-bottom: 1px solid #e2e8f0;
            font-size: 14px;
            color: #1e293b;
        }

        .ppc-table tbody tr:hover {
            background: #f8fafc;
        }

        .ppc-platform-name {
            font-weight: 600;
            color: #2563eb;
        }

        .ppc-recommendations {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            padding: 20px;
            border-left: 4px solid #f59e0b;
        }

        .ppc-recommendations h3 {
            font-size: 16px;
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 16px;
        }

        .ppc-recommendations ul {
            list-style: none;
        }

        .ppc-recommendations li {
            padding: 8px 0;
            padding-left: 24px;
            position: relative;
            font-size: 14px;
            color: #475569;
            line-height: 1.6;
        }

        .ppc-recommendations li:before {
            content: "✓";
            position: absolute;
            left: 0;
            color: #f59e0b;
            font-weight: bold;
        }

        .ppc-loading {
            text-align: center;
            padding: 40px;
            color: #64748b;
        }

        .ppc-error {
            background: #fee2e2;
            color: #991b1b;
            padding: 16px;
            border-radius: 8px;
            margin-bottom: 16px;
            border-left: 4px solid #dc2626;
        }

        .ppc-trend-indicator {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
        }

        .ppc-trend-up {
            background: #d1fae5;
            color: #065f46;
        }

        .ppc-trend-down {
            background: #fee2e2;
            color: #7f1d1d;
        }

        @media (max-width: 768px) {
            .ppc-dashboard-container {
                padding: 16px;
            }

            .ppc-header h1 {
                font-size: 20px;
            }

            .ppc-metrics-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .ppc-charts-grid {
                grid-template-columns: 1fr;
            }

            .ppc-table {
                font-size: 12px;
            }

            .ppc-table th,
            .ppc-table td {
                padding: 8px;
            }
        }

        @media (max-width: 480px) {
            .ppc-metrics-grid {
                grid-template-columns: 1fr;
            }

            .ppc-header h1 {
                font-size: 18px;
            }
        }

        /* Loading spinner */
        .ppc-spinner {
            border: 3px solid #e2e8f0;
            border-top: 3px solid #2563eb;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: ppc-spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes ppc-spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="ppc-dashboard-container" id="ppcDashboard">
        <div class="ppc-loading">
            <div class="ppc-spinner"></div>
            <p>Loading dashboard...</p>
        </div>
    </div>

    <script>
        (function() {
            'use strict';

            // Configuration - UPDATED WITH YOUR GITHUB REPOSITORY
            const CONFIG = {
                dataUrl: 'https://raw.githubusercontent.com/alistermapholisa/ppc-campaign-month-to-month-analysis-dashbord/main/data.json',
                refreshInterval: 3600000 // 1 hour in milliseconds
            };

            // Chart instances
            let charts = {};

            // Fetch data from GitHub
            async function fetchData() {
                try {
                    const response = await fetch(CONFIG.dataUrl, {
                        headers: {
                            'Accept': 'application/json',
                            'Cache-Control': 'no-cache'
                        }
                    });

                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }

                    return await response.json();
                } catch (error) {
                    console.error('Error fetching data:', error);
                    throw error;
                }
            }

            // Format currency
            function formatCurrency(value) {
                return new Intl.NumberFormat('en-ZA', {
                    style: 'currency',
                    currency: 'ZAR',
                    minimumFractionDigits: 2
                }).format(value);
            }

            // Format percentage
            function formatPercentage(value) {
                return (value || 0).toFixed(2) + '%';
            }

            // Calculate trend
            function calculateTrend(current, previous) {
                if (!previous || previous === 0) return null;
                return ((current - previous) / previous) * 100;
            }

            // Render dashboard
            function renderDashboard(data) {
                const container = document.getElementById('ppcDashboard');
                const campaigns = data.campaigns || [];

                if (campaigns.length === 0) {
                    container.innerHTML = '<div class="ppc-error">No campaign data available</div>';
                    return;
                }

                // Sort campaigns by date
                campaigns.sort((a, b) => new Date(b.date) - new Date(a.date));

                const currentCampaign = campaigns[0];
                const previousCampaign = campaigns.length > 1 ? campaigns[1] : null;

                let html = `
                    <div class="ppc-header">
                        <h1>PPC Campaign Performance Dashboard</h1>
                        <p>Last Updated: ${new Date(currentCampaign.date).toLocaleDateString('en-ZA', { year: 'numeric', month: 'long', day: 'numeric' })}</p>
                    </div>
                `;

                // Metrics Grid
                const leadsTrend = previousCampaign ? calculateTrend(currentCampaign.totalLeads, previousCampaign.totalLeads) : null;
                const spendTrend = previousCampaign ? calculateTrend(currentCampaign.totalSpend, previousCampaign.totalSpend) : null;
                const followersTrend = previousCampaign ? calculateTrend(currentCampaign.totalFollowers, previousCampaign.totalFollowers) : null;

                html += `
                    <div class="ppc-metrics-grid">
                        <div class="ppc-metric-card accent-green">
                            <div class="ppc-metric-label">Total Leads</div>
                            <div class="ppc-metric-value">${currentCampaign.totalLeads}</div>
                            ${leadsTrend !== null ? `<div class="ppc-metric-change ${leadsTrend >= 0 ? 'positive' : 'negative'}">
                                ${leadsTrend >= 0 ? '↑' : '↓'} ${Math.abs(leadsTrend).toFixed(1)}% vs last month
                            </div>` : ''}
                        </div>
                        <div class="ppc-metric-card">
                            <div class="ppc-metric-label">Total Spend</div>
                            <div class="ppc-metric-value">${formatCurrency(currentCampaign.totalSpend)}</div>
                            ${spendTrend !== null ? `<div class="ppc-metric-change ${spendTrend >= 0 ? 'negative' : 'positive'}">
                                ${spendTrend >= 0 ? '↑' : '↓'} ${Math.abs(spendTrend).toFixed(1)}% vs last month
                            </div>` : ''}
                        </div>
                        <div class="ppc-metric-card accent-orange">
                            <div class="ppc-metric-label">Followers Gained</div>
                            <div class="ppc-metric-value">${currentCampaign.totalFollowers}</div>
                            ${followersTrend !== null ? `<div class="ppc-metric-change ${followersTrend >= 0 ? 'positive' : 'negative'}">
                                ${followersTrend >= 0 ? '↑' : '↓'} ${Math.abs(followersTrend).toFixed(1)}% vs last month
                            </div>` : ''}
                        </div>
                        <div class="ppc-metric-card accent-red">
                            <div class="ppc-metric-label">Avg Cost Per Lead</div>
                            <div class="ppc-metric-value">${formatCurrency(currentCampaign.totalLeads > 0 ? currentCampaign.totalSpend / currentCampaign.totalLeads : 0)}</div>
                        </div>
                    </div>
                `;

                // Charts Grid
                html += `
                    <div class="ppc-charts-grid">
                        <div class="ppc-chart-container">
                            <div class="ppc-chart-title">Spend Distribution by Platform</div>
                            <div class="ppc-chart-wrapper">
                                <canvas id="spendChart"></canvas>
                            </div>
                        </div>
                        <div class="ppc-chart-container">
                            <div class="ppc-chart-title">Cost Per Click (CPC) Comparison</div>
                            <div class="ppc-chart-wrapper">
                                <canvas id="cpcChart"></canvas>
                            </div>
                        </div>
                        <div class="ppc-chart-container">
                            <div class="ppc-chart-title">Click-Through Rate (CTR) Comparison</div>
                            <div class="ppc-chart-wrapper">
                                <canvas id="ctrChart"></canvas>
                            </div>
                        </div>
                    </div>
                `;

                // Platforms Table
                html += `
                    <div class="ppc-platforms-table">
                        <div class="ppc-table-header">
                            <h3>Platform Performance Breakdown</h3>
                        </div>
                        <table class="ppc-table">
                            <thead>
                                <tr>
                                    <th>Platform</th>
                                    <th>Spend</th>
                                    <th>Impressions</th>
                                    <th>Clicks</th>
                                    <th>CTR</th>
                                    <th>CPC</th>
                                    <th>Leads</th>
                                    <th>Followers</th>
                                </tr>
                            </thead>
                            <tbody>
                `;

                currentCampaign.platforms.forEach(platform => {
                    html += `
                        <tr>
                            <td><span class="ppc-platform-name">${platform.name}</span></td>
                            <td>${formatCurrency(platform.spend)}</td>
                            <td>${platform.impressions.toLocaleString()}</td>
                            <td>${platform.clicks.toLocaleString()}</td>
                            <td>${formatPercentage(platform.ctr)}</td>
                            <td>${formatCurrency(platform.cpc)}</td>
                            <td>${platform.leads || '-'}</td>
                            <td>${platform.followers || '-'}</td>
                        </tr>
                    `;
                });

                html += `
                            </tbody>
                        </table>
                    </div>
                `;

                // Recommendations
                if (currentCampaign.recommendations && currentCampaign.recommendations.length > 0) {
                    html += `
                        <div class="ppc-recommendations">
                            <h3>Recommendations for Next Month</h3>
                            <ul>
                    `;
                    currentCampaign.recommendations.forEach(rec => {
                        html += `<li>${rec}</li>`;
                    });
                    html += `
                            </ul>
                        </div>
                    `;
                }

                container.innerHTML = html;

                // Render charts
                renderCharts(currentCampaign);
            }

            // Render charts
            function renderCharts(campaign) {
                const platforms = campaign.platforms || [];
                const platformNames = platforms.map(p => p.name);
                const spendData = platforms.map(p => p.spend);
                const cpcData = platforms.map(p => p.cpc);
                const ctrData = platforms.map(p => p.ctr);

                const chartConfig = {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'bottom'
                        }
                    }
                };

                // Spend Chart
                const spendCtx = document.getElementById('spendChart');
                if (spendCtx) {
                    if (charts.spend) charts.spend.destroy();
                    charts.spend = new Chart(spendCtx, {
                        type: 'doughnut',
                        data: {
                            labels: platformNames,
                            datasets: [{
                                data: spendData,
                                backgroundColor: ['#2563eb', '#1e40af', '#1e3a8a'],
                                borderColor: '#ffffff',
                                borderWidth: 2
                            }]
                        },
                        options: chartConfig
                    });
                }

                // CPC Chart
                const cpcCtx = document.getElementById('cpcChart');
                if (cpcCtx) {
                    if (charts.cpc) charts.cpc.destroy();
                    charts.cpc = new Chart(cpcCtx, {
                        type: 'bar',
                        data: {
                            labels: platformNames,
                            datasets: [{
                                label: 'Cost Per Click (R)',
                                data: cpcData,
                                backgroundColor: '#f59e0b',
                                borderRadius: 6,
                                borderSkipped: false
                            }]
                        },
                        options: {
                            ...chartConfig,
                            scales: {
                                y: {
                                    beginAtZero: true
                                }
                            }
                        }
                    });
                }

                // CTR Chart
                const ctrCtx = document.getElementById('ctrChart');
                if (ctrCtx) {
                    if (charts.ctr) charts.ctr.destroy();
                    charts.ctr = new Chart(ctrCtx, {
                        type: 'bar',
                        data: {
                            labels: platformNames,
                            datasets: [{
                                label: 'Click-Through Rate (%)',
                                data: ctrData,
                                backgroundColor: '#10b981',
                                borderRadius: 6,
                                borderSkipped: false
                            }]
                        },
                        options: {
                            ...chartConfig,
                            scales: {
                                y: {
                                    beginAtZero: true
                                }
                            }
                        }
                    });
                }
            }

            // Initialize dashboard
            async function init() {
                try {
                    const data = await fetchData();
                    renderDashboard(data);

                    // Auto-refresh
                    setInterval(() => {
                        fetchData().then(renderDashboard).catch(error => {
                            console.error('Auto-refresh failed:', error);
                        });
                    }, CONFIG.refreshInterval);
                } catch (error) {
                    const container = document.getElementById('ppcDashboard');
                    container.innerHTML = `
                        <div class="ppc-error">
                            <strong>Error Loading Dashboard:</strong><br>
                            ${error.message}<br><br>
                            <small>Make sure the GitHub data URL is configured correctly in the script.</small>
                        </div>
                    `;
                }
            }

            // Start when DOM is ready
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', init);
            } else {
                init();
            }
        })();
    </script>
</body>
</html>
